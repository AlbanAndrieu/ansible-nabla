---
# ansible-playbook -i inventory/hosts-albandrieu -c local -v playbooks/nexus.yml -vvvv --ask-become-pass -vvvv  | tee setup.log

- name: Install nexus
  hosts: nexus
#  remote_user: root
  become: true
  
  roles:
    - role: nexus

  vars:
      nexus_home: "/usr/local/{{ nexus_user }}"
      #nexus_version: "3.21.1-01"
      #nexus_dir_conf : "etc"      
      nexus_service_name: "nexus-{{ nexus_version }}"

      ## Repositories Section
      nexus_repositories :
         - id                                              : "central"
           name                                            : "Central"
           providerRole                                    : "org.sonatype.nexus.proxy.repository.Repository"
           providerHint                                    : "maven2"
           localStatus                                     : "IN_SERVICE"
           notFoundCacheActive                             : "true"
           notFoundCacheTTL                                : "1440"
           userManaged                                     : "true"
           exposed                                         : "true"
           browseable                                      : "true"
           writePolicy                                     : "READ_ONLY"
           indexable                                       : "true"
           searchable                                      : "true"
           localStorage                                    : "file"
           remoteStorage                                   : "http://repo1.maven.org/maven2/"
           externalConfiguration_proxyMode                 : "ALLOW"
           externalConfiguration_artifactMaxAge            : "-1"
           externalConfiguration_itemMaxAge                : "1440"
           externalConfiguration_cleanseRepositoryMetadata : "false"
           externalConfiguration_downloadRemoteIndex       : "false"
           externalConfiguration_checksumPolicy            : "WARN"
           externalConfiguration_repositoryPolicy          : "RELEASE"

         - id                                              : "apache-snapshots"
           name                                            : "Apache Snapshots"
           providerRole                                    : "org.sonatype.nexus.proxy.repository.Repository"
           providerHint                                    : "maven2"
           localStatus                                     : "IN_SERVICE"
           notFoundCacheActive                             : "true"
           notFoundCacheTTL                                : "1440"
           userManaged                                     : "true"
           exposed                                         : "true"
           browseable                                      : "true"
           writePolicy                                     : "READ_ONLY"
           indexable                                       : "true"
           searchable                                      : "true"
           localStorage                                    : "file"
           remoteStorage                                   : "http://repository.apache.org/snapshots/"
           externalConfiguration_proxyMode                 : "ALLOW"
           externalConfiguration_artifactMaxAge            : "1440"
           externalConfiguration_itemMaxAge                : "1440"
           externalConfiguration_cleanseRepositoryMetadata : "false"
           externalConfiguration_downloadRemoteIndex       : "false"
           externalConfiguration_checksumPolicy            : "WARN"
           externalConfiguration_repositoryPolicy          : "SNAPSHOT"

         - id                                              : "codehaus-snapshots"
           name                                            : "Codehaus Snapshots"
           providerRole                                    : "org.sonatype.nexus.proxy.repository.Repository"
           providerHint                                    : "maven2"
           localStatus                                     : "IN_SERVICE"
           notFoundCacheActive                             : "true"
           notFoundCacheTTL                                : "1440"
           userManaged                                     : "true"
           exposed                                         : "true"
           browseable                                      : "true"
           writePolicy                                     : "READ_ONLY"
           indexable                                       : "true"
           searchable                                      : "true"
           localStorage                                    : "file"
           remoteStorage                                   : "http://nexus.codehaus.org/snapshots/"
           externalConfiguration_proxyMode                 : "ALLOW"
           externalConfiguration_artifactMaxAge            : "1440"
           externalConfiguration_itemMaxAge                : "1440"
           externalConfiguration_cleanseRepositoryMetadata : "false"
           externalConfiguration_downloadRemoteIndex       : "false"
           externalConfiguration_checksumPolicy            : "WARN"
           externalConfiguration_repositoryPolicy          : "SNAPSHOT"

         - id                                              : "jenkins-releases"
           name                                            : "Jenkins Releases"
           providerRole                                    : "org.sonatype.nexus.proxy.repository.Repository"
           providerHint                                    : "maven2"
           localStatus                                     : "IN_SERVICE"
           notFoundCacheActive                             : "true"
           notFoundCacheTTL                                : "1440"
           userManaged                                     : "true"
           exposed                                         : "true"
           browseable                                      : "true"
           writePolicy                                     : "READ_ONLY"
           indexable                                       : "true"
           searchable                                      : "true"
           localStorage                                    : "file"
           remoteStorage                                   : "https://repo.jenkins-ci.org/releases/"
           externalConfiguration_proxyMode                 : "ALLOW"
           externalConfiguration_artifactMaxAge            : "-1"
           externalConfiguration_itemMaxAge                : "1440"
           externalConfiguration_cleanseRepositoryMetadata : "false"
           externalConfiguration_downloadRemoteIndex       : "false"
           externalConfiguration_checksumPolicy            : "WARN"
           externalConfiguration_repositoryPolicy          : "RELEASE"

         - id                                              : "Imagej-public-repository"
           name                                            : "ImageJ Public Repository"
           providerRole                                    : "org.sonatype.nexus.proxy.repository.Repository"
           providerHint                                    : "maven2"
           localStatus                                     : "IN_SERVICE"
           notFoundCacheActive                             : "true"
           notFoundCacheTTL                                : "1440"
           userManaged                                     : "true"
           exposed                                         : "true"
           browseable                                      : "true"
           writePolicy                                     : "READ_ONLY"
           indexable                                       : "true"
           searchable                                      : "true"
           localStorage                                    : "file"
           remoteStorage                                   : "http://maven.imagej.net/content/repositories/public/"
           externalConfiguration_proxyMode                 : "ALLOW"
           externalConfiguration_artifactMaxAge            : "-1"
           externalConfiguration_itemMaxAge                : "1440"
           externalConfiguration_cleanseRepositoryMetadata : "false"
           externalConfiguration_downloadRemoteIndex       : "false"
           externalConfiguration_checksumPolicy            : "WARN"
           externalConfiguration_repositoryPolicy          : "RELEASE"

         - id                                              : "releases"
           name                                            : "Releases"
           providerRole                                    : "org.sonatype.nexus.proxy.repository.Repository"
           providerHint                                    : "maven2"
           localStatus                                     : "IN_SERVICE"
           notFoundCacheTTL                                : "1440"
           userManaged                                     : "true"
           exposed                                         : "true"
           browseable                                      : "true"
           writePolicy                                     : "ALLOW_WRITE_ONCE"
           indexable                                       : "true"
           searchable                                      : "true"
           localStorage                                    : "file"
           externalConfiguration_proxyMode                 : "ALLOW"
           externalConfiguration_artifactMaxAge            : "-1"
           externalConfiguration_itemMaxAge                : "1440"
           externalConfiguration_cleanseRepositoryMetadata : "false"
           externalConfiguration_downloadRemoteIndex       : "false"
           externalConfiguration_checksumPolicy            : "WARN"
           externalConfiguration_repositoryPolicy          : "RELEASE"

         - id                                              : "snapshots"
           name                                            : "Snapshots"
           providerRole                                    : "org.sonatype.nexus.proxy.repository.Repository"
           providerHint                                    : "maven2"
           localStatus                                     : "IN_SERVICE"
           notFoundCacheTTL                                : "1440"
           itemMaxAge                                      : "1440"
           userManaged                                     : "true"
           exposed                                         : "true"
           browseable                                      : "true"
           writePolicy                                     : "ALLOW_WRITE"
           indexable                                       : "true"
           searchable                                      : "true"
           localStorage                                    : "file"
           externalConfiguration_proxyMode                 : "ALLOW"
           externalConfiguration_artifactMaxAge            : "1440"
           externalConfiguration_itemMaxAge                : "1440"
           externalConfiguration_cleanseRepositoryMetadata : "false"
           externalConfiguration_downloadRemoteIndex       : "false"
           externalConfiguration_checksumPolicy            : "WARN"
           externalConfiguration_repositoryPolicy          : "SNAPSHOT"

         - id                                              : "thirdparty"
           name                                            : "3rd party"
           providerRole                                    : "org.sonatype.nexus.proxy.repository.Repository"
           providerHint                                    : "maven2"
           localStatus                                     : "IN_SERVICE"
           notFoundCacheTTL                                : "1440"
           userManaged                                     : "true"
           exposed                                         : "true"
           browseable                                      : "true"
           writePolicy                                     : "ALLOW_WRITE_ONCE"
           indexable                                       : "true"
           searchable                                      : "true"
           localStorage                                    : "file"
           externalConfiguration_proxyMode                 : "ALLOW"
           externalConfiguration_artifactMaxAge            : "-1"
           externalConfiguration_itemMaxAge                : "1440"
           externalConfiguration_cleanseRepositoryMetadata : "false"
           externalConfiguration_downloadRemoteIndex       : "false"
           externalConfiguration_checksumPolicy            : "WARN"
           externalConfiguration_repositoryPolicy          : "RELEASE"

         - id                                              : "central-m1"
           name                                            : "Central M1 shadow"
           providerRole                                    : "org.sonatype.nexus.proxy.repository.ShadowRepository"
           providerHint                                    : "m2-m1-shadow"
           localStatus                                     : "IN_SERVICE"
           notFoundCacheTTL                                : "15"
           userManaged                                     : "true"
           exposed                                         : "true"
           browseable                                      : "true"
           writePolicy                                     : "READ_ONLY"
           localStorage                                    : "file"
           externalConfiguration_masterRepositoryId        : "central"
           externalConfiguration_syncAtStartup             : "false"

         - id                                              : "public"
           name                                            : "Public Repositories"
           providerRole                                    : "org.sonatype.nexus.proxy.repository.GroupRepository"
           providerHint                                    : "maven2"
           localStatus                                     : "IN_SERVICE"
           notFoundCacheTTL                                : "15"
           userManaged                                     : "true"
           exposed                                         : "true"
           browseable                                      : "true"
           writePolicy                                     : "READ_ONLY"
           indexable                                       : "true"
           localStorage                                    : "file"
           externalConfiguration_mergeMetadata             : "true"
           externalConfiguration_memberRepositories        :
              - "releases"
              - "snapshots"
              - "thirdparty"
              - "central"

         - id                                              : "nabla"
           name                                            : "Nabla Repositories"
           providerRole                                    : "org.sonatype.nexus.proxy.repository.Repository"
           providerHint                                    : "maven2"
           localStatus                                     : "IN_SERVICE"
           notFoundCacheActive                             : "true"
           notFoundCacheTTL                                : "1440"
           userManaged                                     : "true"
           exposed                                         : "true"
           browseable                                      : "true"
           writePolicy                                     : "READ_ONLY"
           indexable                                       : "true"
           searchable                                      : "true"
           localStorage                                    : "file"
           remoteStorage                                   : "http://albandrieu.com:8081/nexus/content/groups/public/"
           externalConfiguration_proxyMode                 : "ALLOW"
           externalConfiguration_artifactMaxAge            : "1440"
           externalConfiguration_itemMaxAge                : "1440"
           externalConfiguration_cleanseRepositoryMetadata : "false"
           externalConfiguration_downloadRemoteIndex       : "false"
           externalConfiguration_checksumPolicy            : "WARN"
           externalConfiguration_repositoryPolicy          : "RELEASE"

         - id                                              : "nabla-releases"
           name                                            : "Nabla Releases Repositories"
           providerRole                                    : "org.sonatype.nexus.proxy.repository.Repository"
           providerHint                                    : "maven2"
           localStatus                                     : "IN_SERVICE"
           notFoundCacheActive                             : "true"
           notFoundCacheTTL                                : "1440"
           userManaged                                     : "true"
           exposed                                         : "true"
           browseable                                      : "true"
           writePolicy                                     : "READ_ONLY"
           indexable                                       : "true"
           searchable                                      : "true"
           localStorage                                    : "file"
           remoteStorage                                   : "http://albandrieu.com:8081/nexus/content/repositories/releases/"
           externalConfiguration_proxyMode                 : "ALLOW"
           externalConfiguration_artifactMaxAge            : "1440"
           externalConfiguration_itemMaxAge                : "1440"
           externalConfiguration_cleanseRepositoryMetadata : "false"
           externalConfiguration_downloadRemoteIndex       : "false"
           externalConfiguration_checksumPolicy            : "WARN"
           externalConfiguration_repositoryPolicy          : "RELEASE"

         - id                                              : "nabla-snapshots"
           name                                            : "Nabla Snapshots Repositories"
           providerRole                                    : "org.sonatype.nexus.proxy.repository.Repository"
           providerHint                                    : "maven2"
           localStatus                                     : "IN_SERVICE"
           notFoundCacheActive                             : "true"
           notFoundCacheTTL                                : "1440"
           userManaged                                     : "true"
           exposed                                         : "true"
           browseable                                      : "true"
           writePolicy                                     : "READ_ONLY"
           indexable                                       : "true"
           searchable                                      : "true"
           localStorage                                    : "file"
           remoteStorage                                   : "http://albandrieu.com:8081/nexus/content/repositories/snapshots/"
           externalConfiguration_proxyMode                 : "ALLOW"
           externalConfiguration_artifactMaxAge            : "1440"
           externalConfiguration_itemMaxAge                : "1440"
           externalConfiguration_cleanseRepositoryMetadata : "false"
           externalConfiguration_downloadRemoteIndex       : "false"
           externalConfiguration_checksumPolicy            : "WARN"
           externalConfiguration_repositoryPolicy          : "SNAPSHOT"

         - id                                              : "mgr-public"
           name                                            : "WORK Repositories"
           providerRole                                    : "org.sonatype.nexus.proxy.repository.Repository"
           providerHint                                    : "maven2"
           localStatus                                     : "IN_SERVICE"
           notFoundCacheActive                             : "true"
           notFoundCacheTTL                                : "1440"
           userManaged                                     : "true"
           exposed                                         : "true"
           browseable                                      : "true"
           writePolicy                                     : "READ_ONLY"
           indexable                                       : "true"
           searchable                                      : "true"
           localStorage                                    : "file"
           remoteStorage                                   : "https://bm-artifacts.misys.global.ad/nexus/content/groups/mgr-public/"
           externalConfiguration_proxyMode                 : "ALLOW"
           externalConfiguration_artifactMaxAge            : "1440"
           externalConfiguration_itemMaxAge                : "1440"
           externalConfiguration_cleanseRepositoryMetadata : "false"
           externalConfiguration_downloadRemoteIndex       : "false"
           externalConfiguration_checksumPolicy            : "WARN"
           externalConfiguration_repositoryPolicy          : "RELEASE"
