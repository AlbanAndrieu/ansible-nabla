---
#This script is used to configure your workstation (for developer)

#sudo ansible-playbook -i hosts -c local -v workstation.yml -vvvv | tee setup.log

- hosts: all
  gather_facts: true
  tasks:
    - name: group hosts by distribution
      group_by: key="{{ ansible_distribution }}-{{ ansible_distribution_version }}"

- hosts: RedHat-7*:RedHat-6*:CentOS-6*:Ubuntu-12.04:Ubuntu-14.04
  gather_facts: false
  tasks:
    - name: group hosts for supported distributions
      group_by: key="supported"

- hosts: "!supported"
  gather_facts: false
  tasks:
    - name: fail for unsupported distribution
      fail: msg="{{ ansible_distribution }} {{ ansible_distribution_version }}
                 is not a supported OS for a Tower installation.  Supported
                 OSes include Red Hat Enterprise Linux 6/7, CentOS 6, or
                 Ubuntu 12.04/14.04."

- name: Install sonar
  hosts: sonar
  remote_user: root
#  connection: local
  roles:
    - role: sonar

  vars:
#TODO merge sonar-runner.properties.j2 file from jenkins_slave role
      sonar_analyzer_runner_install: false
#Handle by jenkins_slave role, Warning it will override settings.xml.j2 from jenkins_slave role
      maven_install: false
      sonar_mysql_install: true
      sonar_jdbc_driver: "mysql"
      sonar_jdbc_port: 3306
      mysql_root_username: root
      mysql_root_password: microsoft             
      sonar_jdbc_pass: "{{ mysql_root_password }}" 
      sonar_login_user: "{{ mysql_root_username }}"
      sonar_login_password: "{{ mysql_root_password }}"  
      sonar_shell: "/bin/false"

